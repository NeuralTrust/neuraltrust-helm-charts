{{- $secretName := printf "%s-secrets" .Release.Name }}
{{- $existingSecret := (lookup "v1" "Secret" .Release.Namespace $secretName) }}
{{- $preserveSecrets := .Values.controlPlane.preserveExistingSecrets }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ $secretName }}
  namespace: {{ .Release.Namespace }}
type: Opaque
data:
  # Control Plane JWT Secret
  # Supports both direct value or secret reference: {secretName: "my-secret", secretKey: "CONTROL_PLANE_JWT_SECRET"}
  CONTROL_PLANE_JWT_SECRET: {{ include "control-plane.getSecretValue" (dict "value" .Values.controlPlane.secrets.controlPlaneJWTSecret "secretName" $secretName "secretKey" "CONTROL_PLANE_JWT_SECRET" "context" $) }}
  
  # OpenAI API Key
  # Supports both direct value or secret reference: {secretName: "my-secret", secretKey: "OPENAI_API_KEY"}
  OPENAI_API_KEY: {{ include "control-plane.getSecretValue" (dict "value" .Values.controlPlane.secrets.openaiApiKey "secretName" $secretName "secretKey" "OPENAI_API_KEY" "context" $) }}
  
  # Resend API secrets
  # Supports both direct value or secret reference: {secretName: "my-secret", secretKey: "resend-api-key"}
  resend-api-key: {{ include "control-plane.getSecretValue" (dict "value" (.Values.controlPlane.secrets.resendApiKey | default "") "secretName" $secretName "secretKey" "resend-api-key" "context" $) }}
  resend-alert-sender: {{ include "control-plane.getSecretValue" (dict "value" (.Values.controlPlane.secrets.resendAlertSender | default "") "secretName" $secretName "secretKey" "resend-alert-sender" "context" $) }}
  resend-invite-sender: {{ include "control-plane.getSecretValue" (dict "value" (.Values.controlPlane.secrets.resendInviteSender | default "") "secretName" $secretName "secretKey" "resend-invite-sender" "context" $) }}
  
  # Trustgate JWT Secret
  # Supports both direct value or secret reference: {secretName: "my-secret", secretKey: "TRUSTGATE_JWT_SECRET"}
  TRUSTGATE_JWT_SECRET: {{ include "control-plane.getSecretValue" (dict "value" (.Values.controlPlane.secrets.trustgateJwtSecret | default "") "secretName" $secretName "secretKey" "TRUSTGATE_JWT_SECRET" "context" $) }}
  
  # Firewall JWT Secret
  # Supports both direct value or secret reference: {secretName: "my-secret", secretKey: "FIREWALL_JWT_SECRET"}
  FIREWALL_JWT_SECRET: {{ include "control-plane.getSecretValue" (dict "value" (.Values.controlPlane.secrets.firewallJwtSecret | default "") "secretName" $secretName "secretKey" "FIREWALL_JWT_SECRET" "context" $) }}
  
  # Model Scanner Secret
  # Supports both direct value or secret reference: {secretName: "my-secret", secretKey: "MODEL_SCANNER_SECRET"}
  MODEL_SCANNER_SECRET: {{ include "control-plane.getSecretValue" (dict "value" (.Values.controlPlane.secrets.modelScannerSecret | default "") "secretName" $secretName "secretKey" "MODEL_SCANNER_SECRET" "context" $) }}