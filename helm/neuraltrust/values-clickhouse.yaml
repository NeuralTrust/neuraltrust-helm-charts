# ClickHouse configuration for OpenShift deployment
# This file contains default configuration values that were previously passed via --set

auth:
  username: "neuraltrust"
  # password should be set via --set (sensitive data)

shards: 1
replicaCount: 1

zookeeper:
  enabled: false

persistence:
  enabled: true
  storageClass: ""
  size: "100Gi"

resources:
  requests:
    memory: "4Gi"
    cpu: "2"
  limits:
    memory: "8Gi"
    cpu: "4"

logLevel: "fatal"

# Security settings for OpenShift
securityContext:
  enabled: true
  runAsUser: 1001
  runAsGroup: 1001
  fsGroup: 1001

# OpenShift specific settings
openshift:
  enabled: true

# CephFS compatibility configuration
# CephFS doesn't support renameat2() system call used by ClickHouse Atomic engine
extraOverrides: |
  <clickhouse>
    <merge_tree>
      <!-- Disable fsync for metadata to avoid filesystem incompatibilities -->
      <fsync_metadata>0</fsync_metadata>
    </merge_tree>
  </clickhouse>

# Environment variables for CephFS compatibility
extraEnvVars:
  - name: CLICKHOUSE_DO_NOT_CHROOT
    value: "1"